<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Buscar Usuarios - ClassUp</title>
  <link rel="stylesheet" href="css/busqueda.css">
</head>
<body>
  <div class="container">

    <!-- Header -->
    <header class="profile-section">
      <h1>üîç Buscar Usuarios</h1>
      <div class="search-bar">
        <img src="lupa.png" alt="Lupa" class="search-icon">
        <input type="text" id="search-input" placeholder="Buscar por nombre de usuario...">
        <ul id="suggestions" class="hidden"></ul>
      </div>
    </header>

    <!-- Resultados -->
    <section class="resultados" id="lista-usuarios">
      <p class="empty-msg">Comienza a buscar usuarios...</p>
    </section>

  </div>

  <!-- Cuadro inferior fijo -->
  <div class="cuadro-opciones">
    <a href="inicio.php" class="boton-opcion">üè† Inicio</a>
    <a href="busqueda.html" class="boton-opcion">üîç Buscar</a>
    <a href="perfil.html" class="boton-opcion">üë§ Perfil</a>
    <a href="amigos.html" class="boton-opcion">üë• Amigos</a>
    <a href="configuracion.html" class="boton-opcion">‚öôÔ∏è Ajustes</a>
  </div>

  <script>
    // Variables principales
    const usuarioActual = JSON.parse(localStorage.getItem("usuarioActual")) || {usuario: "invitado"};
    const searchInput = document.getElementById('search-input');
    const listaUsuarios = document.getElementById('lista-usuarios');
    const clave = `amigos_${usuarioActual.usuario}`;
    let amigos = JSON.parse(localStorage.getItem(clave)) || [];

    // Funci√≥n para obtener usuarios de la base de datos
    async function fetchUsuarios(texto = '') {
      const response = await fetch(`buscarUsuarios.php?q=${encodeURIComponent(texto)}&usuarioActual=${usuarioActual.usuario}`);
      const data = await response.json();
      return data;
    }

    // Funci√≥n para mostrar los usuarios en pantalla
    async function renderUsuarios(texto = '') {
      const usuarios = await fetchUsuarios(texto);

      listaUsuarios.innerHTML = '';
      if(usuarios.length === 0){
        listaUsuarios.innerHTML = '<p class="empty-msg">No se encontraron usuarios.</p>';
      } else {
        usuarios.forEach(u => {
          const div = document.createElement('div');
          div.classList.add('usuario-card');

          const esAmigo = amigos.some(a => a.usuario === u.usuario);
          const btnAgregar = esAmigo ? '' : `<button class="add-btn">Agregar</button>`;

          div.innerHTML = `
            <div class="usuario-info">
              <img src="${u.foto}" alt="Foto de ${u.nombre}" class="usuario-foto">
              <div>
                <p class="usuario-nombre">${u.nombre}</p>
                <p>@${u.usuario}</p>
              </div>
            </div>
            ${btnAgregar}
          `;
          listaUsuarios.appendChild(div);

          if(!esAmigo){
            div.querySelector('.add-btn').addEventListener('click', () => {
              amigos.push(u);
              localStorage.setItem(clave, JSON.stringify(amigos));
              renderUsuarios(searchInput.value);
            });
          }
        });
      }
    }

    // Evento para b√∫squeda en tiempo real
    searchInput.addEventListener('input', () => renderUsuarios(searchInput.value));

    // Render inicial
    renderUsuarios();
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Calendario Social</title>
  <link rel="stylesheet" href="css/inicio.css">
  <style>
    .campana-btn {
      background: none;
      border: none;
      font-size: 22px;
      cursor: pointer;
      margin-left: auto;
      transition: transform 0.2s ease;
    }
    .campana-btn:hover { transform: scale(1.2); }
    .comentarios-section { border-top: 1px solid #ccc; padding-top: 8px; margin-top: 10px; }
    .comentarios-section textarea { width: 100%; resize: none; margin-top: 5px; border-radius: 5px; padding: 5px; }
    .comentarios-section button { margin-top: 5px; background-color: #7a5c3d; color: #fff; border: none; border-radius: 5px; padding: 4px 10px; cursor: pointer; }
    .comentario { background-color: #f0f0f0; color: #000; border-radius: 6px; padding: 5px 8px; margin-top: 5px; }
  </style>
</head>
<body>
  <header class="app-header">
    <div class="brand">
      <div class="ClassUp.png" role="img" aria-label="ClassUp logo"></div>
      <h1 class="app-title">ClassUp</h1>
    </div>
  </header>

  <div class="container">
    <header class="profile-section">
      <div class="profile-card">
        <img id="foto-perfil-inicio" src="https://via.placeholder.com/100" alt="fotoPerfil" class="profile-pic">
        <div class="profile-info">
          <h2>Mi Calendario Social</h2>
          <p>@<?= htmlspecialchars($usuario ?? "Invitado") ?></p>
        </div>
      </div>
    </header>

    <section class="calendar-section">
      <h3>Recordatorios recientes</h3>
      <button class="event-btn" onclick="toggleCalendario()">‚ûï Nuevo recordatorio</button>
      
      <div id="calendarioContainer" style="display:none; margin-top:15px;">
        <div id="calendar-header">
          <button id="prev-month"><--</button>
          <h2 id="month-year"></h2>
          <button id="next-month">--></button>
        </div>
        <div id="calendar"></div>

        <!-- Formulario que guarda eventos -->
        <form id="event-form" method="POST">
          <input type="text" name="titulo" id="event-title" placeholder="T√≠tulo del evento" required>
          <input type="date" name="fecha" id="event-date" required>
          <input type="time" name="hora" id="event-time">
          <input type="text" name="descripcion" id="event-desc" placeholder="Descripci√≥n (opcional)">
          <button type="submit" id="add-event">Agregar evento</button>
        </form>
      </div>

      <div id="postsContainer">
        <?php if (empty($eventos)): ?>
          <p class="empty-msg">Todav√≠a no hay recordatorios üì≠</p>
        <?php else: ?>
          <?php foreach ($eventos as $ev): ?>
            <div class="post">
              <div class="post-header">
                <img src="<?= htmlspecialchars($_SESSION['fotoPerfil'] ?? 'https://via.placeholder.com/50') ?>" class="avatar" alt="avatar">
                <div>
                  <strong><?= htmlspecialchars($ev['titulo']) ?></strong>
                  <p class="post-date">üìÖ <?= htmlspecialchars($ev['fecha']) ?> ‚è∞ <?= htmlspecialchars($ev['hora'] ?? "Sin hora") ?></p>
                </div>
                <button class="campana-btn" onclick="activarCampana()">üîî</button>
              </div>
              <div class="post-content">
                <p><?= htmlspecialchars($ev['descripcion'] ?? "Sin descripci√≥n") ?></p>
              </div>
              <div class="comentarios-section">
                <h4>Comentarios</h4>
                <div class="lista-comentarios"></div>
                <textarea placeholder="Escribe un comentario..."></textarea>
                <button onclick="agregarComentario(this)">Comentar</button>
              </div>
            </div>
          <?php endforeach; ?>
        <?php endif; ?>
      </div>
    </section>

    <div class="cuadro-opciones">
      <a href="inicio.php" class="boton-opcion">üè† Inicio</a>
      <a href="busqueda.html" class="boton-opcion">üîç Buscar</a>
      <a href="perfil.html" class="boton-opcion">üë§ Perfil</a>
      <a href="amigos.html" class="boton-opcion">üë• Amigos</a>
      <a href="configuracion.html" class="boton-opcion">‚öôÔ∏è Ajustes</a>
    </div>
  </div>

  <script>
    const calendarioContainer = document.getElementById("calendarioContainer");
    function toggleCalendario() {
      calendarioContainer.style.display =
        calendarioContainer.style.display === "none" ? "block" : "none";
      renderCalendar();
    }

    // --- Calendario ---
    const calendar = document.getElementById("calendar");
    const monthYear = document.getElementById("month-year");
    let currentDate = new Date();

    function renderCalendar() {
      calendar.innerHTML = "";
      const year = currentDate.getFullYear();
      const month = currentDate.getMonth();
      const firstDay = new Date(year, month, 1).getDay();
      const lastDate = new Date(year, month + 1, 0).getDate();
      const today = new Date();
      const months = ["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"];
      monthYear.textContent = `${months[month]} ${year}`;

      for (let i = 0; i < (firstDay === 0 ? 6 : firstDay - 1); i++) {
        const empty = document.createElement("div");
        calendar.appendChild(empty);
      }

      for (let d = 1; d <= lastDate; d++) {
        const day = document.createElement("div");
        day.textContent = d;
        day.classList.add("day");
        if (d === today.getDate() && month === today.getMonth() && year === today.getFullYear()) {
          day.classList.add("today");
        }
        calendar.appendChild(day);
      }
    }

    document.getElementById("prev-month").onclick = () => {
      currentDate.setMonth(currentDate.getMonth() - 1);
      renderCalendar();
    };
    document.getElementById("next-month").onclick = () => {
      currentDate.setMonth(currentDate.getMonth() + 1);
      renderCalendar();
    };

    function activarCampana() {
      alert("Recordatorio activado üîî");
    }

    function agregarComentario(btn) {
      const section = btn.closest(".comentarios-section");
      const textarea = section.querySelector("textarea");
      const lista = section.querySelector(".lista-comentarios");
      const texto = textarea.value.trim();
      if (texto === "") {
        alert("Escribe un comentario antes de enviar.");
        return;
      }
      const nuevo = document.createElement("p");
      nuevo.classList.add("comentario");
      nuevo.textContent = texto;
      lista.appendChild(nuevo);
      textarea.value = "";
    }

    renderCalendar();
  </script>
</body>
</html>
